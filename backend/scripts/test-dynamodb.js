"use strict";
/**
 * Test DynamoDB Local Connection and Operations
 * Verifies that local DynamoDB is working properly with basic CRUD operations
 */
Object.defineProperty(exports, "__esModule", { value: true });
const dotenv = require("dotenv");
dotenv.config();
const client_dynamodb_1 = require("@aws-sdk/client-dynamodb");
const lib_dynamodb_1 = require("@aws-sdk/lib-dynamodb");
// Configuration for local DynamoDB
const client = new client_dynamodb_1.DynamoDBClient({
    region: process.env.AWS_REGION || 'us-east-1',
    endpoint: process.env.DYNAMODB_ENDPOINT || 'http://localhost:8002',
    credentials: {
        accessKeyId: process.env.AWS_ACCESS_KEY_ID || 'local',
        secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY || 'local',
    },
});
const docClient = lib_dynamodb_1.DynamoDBDocumentClient.from(client);
const STUDENTS_TABLE = process.env.STUDENTS_TABLE_NAME || 'ho-yu-students';
const results = [];
/**
 * Test: Create (PUT) Operation
 */
async function testCreate() {
    try {
        const testStudent = {
            student_id: 'TEST_STUDENT_001',
            name_1: 'Test Student',
            name_2: '測試學生',
            marks: 100,
            class: 'TEST',
            class_no: '01',
            teacher_id: 'TCH001',
            password: '123',
            last_login: new Date().toISOString(),
            last_update: new Date().toISOString(),
        };
        const command = new lib_dynamodb_1.PutCommand({
            TableName: STUDENTS_TABLE,
            Item: testStudent,
        });
        await docClient.send(command);
        return {
            test: 'CREATE',
            status: 'PASS',
            message: 'Successfully created test student',
        };
    }
    catch (error) {
        return {
            test: 'CREATE',
            status: 'FAIL',
            message: error.message,
        };
    }
}
/**
 * Test: Read (GET) Operation
 */
async function testRead() {
    try {
        const command = new lib_dynamodb_1.GetCommand({
            TableName: STUDENTS_TABLE,
            Key: { student_id: 'TEST_STUDENT_001' },
        });
        const result = await docClient.send(command);
        if (result.Item && result.Item.student_id === 'TEST_STUDENT_001') {
            return {
                test: 'READ',
                status: 'PASS',
                message: 'Successfully read test student',
            };
        }
        else {
            return {
                test: 'READ',
                status: 'FAIL',
                message: 'Student not found or data mismatch',
            };
        }
    }
    catch (error) {
        return {
            test: 'READ',
            status: 'FAIL',
            message: error.message,
        };
    }
}
/**
 * Test: Update (UPDATE) Operation
 */
async function testUpdate() {
    try {
        const command = new lib_dynamodb_1.UpdateCommand({
            TableName: STUDENTS_TABLE,
            Key: { student_id: 'TEST_STUDENT_001' },
            UpdateExpression: 'SET marks = :marks',
            ExpressionAttributeValues: {
                ':marks': 200,
            },
            ReturnValues: 'ALL_NEW',
        });
        const result = await docClient.send(command);
        if (result.Attributes && result.Attributes.marks === 200) {
            return {
                test: 'UPDATE',
                status: 'PASS',
                message: 'Successfully updated test student marks',
            };
        }
        else {
            return {
                test: 'UPDATE',
                status: 'FAIL',
                message: 'Update did not reflect expected changes',
            };
        }
    }
    catch (error) {
        return {
            test: 'UPDATE',
            status: 'FAIL',
            message: error.message,
        };
    }
}
/**
 * Test: Delete (DELETE) Operation
 */
async function testDelete() {
    try {
        const command = new lib_dynamodb_1.DeleteCommand({
            TableName: STUDENTS_TABLE,
            Key: { student_id: 'TEST_STUDENT_001' },
        });
        await docClient.send(command);
        // Verify deletion
        const getCommand = new lib_dynamodb_1.GetCommand({
            TableName: STUDENTS_TABLE,
            Key: { student_id: 'TEST_STUDENT_001' },
        });
        const result = await docClient.send(getCommand);
        if (!result.Item) {
            return {
                test: 'DELETE',
                status: 'PASS',
                message: 'Successfully deleted test student',
            };
        }
        else {
            return {
                test: 'DELETE',
                status: 'FAIL',
                message: 'Student still exists after deletion',
            };
        }
    }
    catch (error) {
        return {
            test: 'DELETE',
            status: 'FAIL',
            message: error.message,
        };
    }
}
/**
 * Test: Scan Operation
 */
async function testScan() {
    try {
        const command = new lib_dynamodb_1.ScanCommand({
            TableName: STUDENTS_TABLE,
            Limit: 5,
        });
        const result = await docClient.send(command);
        if (result.Items && result.Items.length > 0) {
            return {
                test: 'SCAN',
                status: 'PASS',
                message: `Successfully scanned table (${result.Items.length} items found)`,
            };
        }
        else {
            return {
                test: 'SCAN',
                status: 'FAIL',
                message: 'No items found in table (may need to seed data)',
            };
        }
    }
    catch (error) {
        return {
            test: 'SCAN',
            status: 'FAIL',
            message: error.message,
        };
    }
}
/**
 * Run all tests
 */
async function runTests() {
    console.log('╔════════════════════════════════════════════════════════════╗');
    console.log('║       DynamoDB Local Connection Test Suite                ║');
    console.log('╚════════════════════════════════════════════════════════════╝\n');
    console.log('Configuration:');
    console.log(`  Endpoint: ${process.env.DYNAMODB_ENDPOINT || 'http://localhost:8002'}`);
    console.log(`  Region: ${process.env.AWS_REGION || 'us-east-1'}`);
    console.log(`  Mode: ${process.env.DYNAMODB_MODE || 'aws'}`);
    console.log(`  Table: ${STUDENTS_TABLE}\n`);
    console.log('Running tests...\n');
    // Run tests sequentially
    results.push(await testCreate());
    results.push(await testRead());
    results.push(await testUpdate());
    results.push(await testDelete());
    results.push(await testScan());
    // Print results
    console.log('Test Results:');
    console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n');
    results.forEach((result) => {
        const statusIcon = result.status === 'PASS' ? '✓' : '✗';
        const statusColor = result.status === 'PASS' ? '✓' : '✗';
        console.log(`  ${statusColor} ${result.test.padEnd(10)} ${result.status}`);
        if (result.message) {
            console.log(`    └─ ${result.message}`);
        }
    });
    console.log('\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
    // Summary
    const passCount = results.filter((r) => r.status === 'PASS').length;
    const failCount = results.filter((r) => r.status === 'FAIL').length;
    console.log(`\nSummary: ${passCount} passed, ${failCount} failed out of ${results.length} tests\n`);
    if (failCount === 0) {
        console.log('✓ All tests passed! DynamoDB Local is working correctly.\n');
        process.exit(0);
    }
    else {
        console.log('✗ Some tests failed. Check configuration and DynamoDB Local status.\n');
        console.log('Troubleshooting:');
        console.log('  1. Ensure DynamoDB Local is running: npm run dynamodb:start');
        console.log('  2. Verify tables are created: npm run dynamodb:init');
        console.log('  3. Check environment variables in .env file');
        console.log('  4. Verify Docker containers: docker ps');
        console.log('  5. Check logs: npm run dynamodb:logs\n');
        process.exit(1);
    }
}
// Run tests
runTests().catch((error) => {
    console.error('Fatal error running tests:', error);
    process.exit(1);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC1keW5hbW9kYi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInRlc3QtZHluYW1vZGIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7QUFFSCxpQ0FBaUM7QUFDakMsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBRWhCLDhEQUEwRDtBQUMxRCx3REFPK0I7QUFFL0IsbUNBQW1DO0FBQ25DLE1BQU0sTUFBTSxHQUFHLElBQUksZ0NBQWMsQ0FBQztJQUNoQyxNQUFNLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLElBQUksV0FBVztJQUM3QyxRQUFRLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsSUFBSSx1QkFBdUI7SUFDbEUsV0FBVyxFQUFFO1FBQ1gsV0FBVyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLElBQUksT0FBTztRQUNyRCxlQUFlLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsSUFBSSxPQUFPO0tBQzlEO0NBQ0YsQ0FBQyxDQUFDO0FBRUgsTUFBTSxTQUFTLEdBQUcscUNBQXNCLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQ3RELE1BQU0sY0FBYyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLElBQUksZ0JBQWdCLENBQUM7QUFRM0UsTUFBTSxPQUFPLEdBQWlCLEVBQUUsQ0FBQztBQUVqQzs7R0FFRztBQUNILEtBQUssVUFBVSxVQUFVO0lBQ3ZCLElBQUksQ0FBQztRQUNILE1BQU0sV0FBVyxHQUFHO1lBQ2xCLFVBQVUsRUFBRSxrQkFBa0I7WUFDOUIsTUFBTSxFQUFFLGNBQWM7WUFDdEIsTUFBTSxFQUFFLE1BQU07WUFDZCxLQUFLLEVBQUUsR0FBRztZQUNWLEtBQUssRUFBRSxNQUFNO1lBQ2IsUUFBUSxFQUFFLElBQUk7WUFDZCxVQUFVLEVBQUUsUUFBUTtZQUNwQixRQUFRLEVBQUUsS0FBSztZQUNmLFVBQVUsRUFBRSxJQUFJLElB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QUFDLDBDQUEwQyxDQUFDLENBQUM7UUFDeEQsT0FBTyxDQUFDLEdBQUcsQ0FBQywwQ0FBMEMsQ0FBQyxDQUFDO1FBQ3hELE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbEIsQ0FBQztBQUNILENBQUM7QUFFRCxZQUFZO0FBQ1osUUFBUSxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUU7SUFDekIsT0FBTyxDQUFDLEtBQUssQ0FBQyw0QkFBNEIsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNuRCxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ2xCLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUZXN0IER5bmFtb0RCIExvY2FsIENvbm5lY3Rpb24gYW5kIE9wZXJhdGlvbnNcbiAqIFZlcmlmaWVzIHRoYXQgbG9jYWwgRHluYW1vREIgaXMgd29ya2luZyBwcm9wZXJseSB3aXRoIGJhc2ljIENSVUQgb3BlcmF0aW9uc1xuICovXG5cbmltcG9ydCAqIGFzIGRvdGVudiBmcm9tICdkb3RlbnYnO1xuZG90ZW52LmNvbmZpZygpO1xuXG5pbXBvcnQgeyBEeW5hbW9EQkNsaWVudCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1keW5hbW9kYic7XG5pbXBvcnQge1xuICBEeW5hbW9EQkRvY3VtZW50Q2xpZW50LFxuICBQdXRDb21tYW5kLFxuICBHZXRDb21tYW5kLFxuICBVcGRhdGVDb21tYW5kLFxuICBEZWxldGVDb21tYW5kLFxuICBTY2FuQ29tbWFuZCxcbn0gZnJvbSAnQGF3cy1zZGsvbGliLWR5bmFtb2RiJztcblxuLy8gQ29uZmlndXJhdGlvbiBmb3IgbG9jYWwgRHluYW1vREJcbmNvbnN0IGNsaWVudCA9IG5ldyBEeW5hbW9EQkNsaWVudCh7XG4gIHJlZ2lvbjogcHJvY2Vzcy5lbnYuQVdTX1JFR0lPTiB8fCAndXMtZWFzdC0xJyxcbiAgZW5kcG9pbnQ6IHByb2Nlc3MuZW52LkRZTkFNT0RCX0VORFBPSU5UIHx8ICdodHRwOi8vbG9jYWxob3N0OjgwMDInLFxuICBjcmVkZW50aWFsczoge1xuICAgIGFjY2Vzc0tleUlkOiBwcm9jZXNzLmVudi5BV1NfQUNDRVNTX0tFWV9JRCB8fCAnbG9jYWwnLFxuICAgIHNlY3JldEFjY2Vzc0tleTogcHJvY2Vzcy5lbnYuQVdTX1NFQ1JFVF9BQ0NFU1NfS0VZIHx8ICdsb2NhbCcsXG4gIH0sXG59KTtcblxuY29uc3QgZG9jQ2xpZW50ID0gRHluYW1vREJEb2N1bWVudENsaWVudC5mcm9tKGNsaWVudCk7XG5jb25zdCBTVFVERU5UU19UQUJMRSA9IHByb2Nlc3MuZW52LlNUVURFTlRTX1RBQkxFX05BTUUgfHwgJ2hvLXl1LXN0dWRlbnRzJztcblxuaW50ZXJmYWNlIFRlc3RSZXN1bHQge1xuICB0ZXN0OiBzdHJpbmc7XG4gIHN0YXR1czogJ1BBU1MnIHwgJ0ZBSUwnO1xuICBtZXNzYWdlPzogc3RyaW5nO1xufVxuXG5jb25zdCByZXN1bHRzOiBUZXN0UmVzdWx0W10gPSBbXTtcblxuLyoqXG4gKiBUZXN0OiBDcmVhdGUgKFBVVCkgT3BlcmF0aW9uXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHRlc3RDcmVhdGUoKTogUHJvbWlzZTxUZXN0UmVzdWx0PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgdGVzdFN0dWRlbnQgPSB7XG4gICAgICBzdHVkZW50X2lkOiAnVEVTVF9TVFVERU5UXzAwMScsXG4gICAgICBuYW1lXzE6ICdUZXN0IFN0dWRlbnQnLFxuICAgICAgbmFtZV8yOiAn5ris6Kmm5a2455SfJyxcbiAgICAgIG1hcmtzOiAxMDAsXG4gICAgICBjbGFzczogJ1RFU1QnLFxuICAgICAgY2xhc3Nfbm86ICcwMScsXG4gICAgICB0ZWFjaGVyX2lkOiAnVENIMDAxJyxcbiAgICAgIHBhc3N3b3JkOiAnMTIzJyxcbiAgICAgIGxhc3RfbG9naW46IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIGxhc3RfdXBkYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgfTtcblxuICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgUHV0Q29tbWFuZCh7XG4gICAgICBUYWJsZU5hbWU6IFNUVURFTlRTX1RBQkxFLFxuICAgICAgSXRlbTogdGVzdFN0dWRlbnQsXG4gICAgfSk7XG5cbiAgICBhd2FpdCBkb2NDbGllbnQuc2VuZChjb21tYW5kKTtcblxuICAgIHJldHVybiB7XG4gICAgICB0ZXN0OiAnQ1JFQVRFJyxcbiAgICAgIHN0YXR1czogJ1BBU1MnLFxuICAgICAgbWVzc2FnZTogJ1N1Y2Nlc3NmdWxseSBjcmVhdGVkIHRlc3Qgc3R1ZGVudCcsXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIHJldHVybiB7XG4gICAgICB0ZXN0OiAnQ1JFQVRFJyxcbiAgICAgIHN0YXR1czogJ0ZBSUwnLFxuICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogVGVzdDogUmVhZCAoR0VUKSBPcGVyYXRpb25cbiAqL1xuYXN5bmMgZnVuY3Rpb24gdGVzdFJlYWQoKTogUHJvbWlzZTxUZXN0UmVzdWx0PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY29tbWFuZCA9IG5ldyBHZXRDb21tYW5kKHtcbiAgICAgIFRhYmxlTmFtZTogU1RVREVOVFNfVEFCTEUsXG4gICAgICBLZXk6IHsgc3R1ZGVudF9pZDogJ1RFU1RfU1RVREVOVF8wMDEnIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkb2NDbGllbnQuc2VuZChjb21tYW5kKTtcblxuICAgIGlmIChyZXN1bHQuSXRlbSAmJiByZXN1bHQuSXRlbS5zdHVkZW50X2lkID09PSAnVEVTVF9TVFVERU5UXzAwMScpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRlc3Q6ICdSRUFEJyxcbiAgICAgICAgc3RhdHVzOiAnUEFTUycsXG4gICAgICAgIG1lc3NhZ2U6ICdTdWNjZXNzZnVsbHkgcmVhZCB0ZXN0IHN0dWRlbnQnLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGVzdDogJ1JFQUQnLFxuICAgICAgICBzdGF0dXM6ICdGQUlMJyxcbiAgICAgICAgbWVzc2FnZTogJ1N0dWRlbnQgbm90IGZvdW5kIG9yIGRhdGEgbWlzbWF0Y2gnLFxuICAgICAgfTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdGVzdDogJ1JFQUQnLFxuICAgICAgc3RhdHVzOiAnRkFJTCcsXG4gICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBUZXN0OiBVcGRhdGUgKFVQREFURSkgT3BlcmF0aW9uXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHRlc3RVcGRhdGUoKTogUHJvbWlzZTxUZXN0UmVzdWx0PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY29tbWFuZCA9IG5ldyBVcGRhdGVDb21tYW5kKHtcbiAgICAgIFRhYmxlTmFtZTogU1RVREVOVFNfVEFCTEUsXG4gICAgICBLZXk6IHsgc3R1ZGVudF9pZDogJ1RFU1RfU1RVREVOVF8wMDEnIH0sXG4gICAgICBVcGRhdGVFeHByZXNzaW9uOiAnU0VUIG1hcmtzID0gOm1hcmtzJyxcbiAgICAgIEV4cHJlc3Npb25BdHRyaWJ1dGVWYWx1ZXM6IHtcbiAgICAgICAgJzptYXJrcyc6IDIwMCxcbiAgICAgIH0sXG4gICAgICBSZXR1cm5WYWx1ZXM6ICdBTExfTkVXJyxcbiAgICB9KTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRvY0NsaWVudC5zZW5kKGNvbW1hbmQpO1xuXG4gICAgaWYgKHJlc3VsdC5BdHRyaWJ1dGVzICYmIHJlc3VsdC5BdHRyaWJ1dGVzLm1hcmtzID09PSAyMDApIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRlc3Q6ICdVUERBVEUnLFxuICAgICAgICBzdGF0dXM6ICdQQVNTJyxcbiAgICAgICAgbWVzc2FnZTogJ1N1Y2Nlc3NmdWxseSB1cGRhdGVkIHRlc3Qgc3R1ZGVudCBtYXJrcycsXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0ZXN0OiAnVVBEQVRFJyxcbiAgICAgICAgc3RhdHVzOiAnRkFJTCcsXG4gICAgICAgIG1lc3NhZ2U6ICdVcGRhdGUgZGlkIG5vdCByZWZsZWN0IGV4cGVjdGVkIGNoYW5nZXMnLFxuICAgICAgfTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdGVzdDogJ1VQREFURScsXG4gICAgICBzdGF0dXM6ICdGQUlMJyxcbiAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIFRlc3Q6IERlbGV0ZSAoREVMRVRFKSBPcGVyYXRpb25cbiAqL1xuYXN5bmMgZnVuY3Rpb24gdGVzdERlbGV0ZSgpOiBQcm9taXNlPFRlc3RSZXN1bHQ+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjb21tYW5kID0gbmV3IERlbGV0ZUNvbW1hbmQoe1xuICAgICAgVGFibGVOYW1lOiBTVFVERU5UU19UQUJMRSxcbiAgICAgIEtleTogeyBzdHVkZW50X2lkOiAnVEVTVF9TVFVERU5UXzAwMScgfSxcbiAgICB9KTtcblxuICAgIGF3YWl0IGRvY0NsaWVudC5zZW5kKGNvbW1hbmQpO1xuXG4gICAgLy8gVmVyaWZ5IGRlbGV0aW9uXG4gICAgY29uc3QgZ2V0Q29tbWFuZCA9IG5ldyBHZXRDb21tYW5kKHtcbiAgICAgIFRhYmxlTmFtZTogU1RVREVOVFNfVEFCTEUsXG4gICAgICBLZXk6IHsgc3R1ZGVudF9pZDogJ1RFU1RfU1RVREVOVF8wMDEnIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkb2NDbGllbnQuc2VuZChnZXRDb21tYW5kKTtcblxuICAgIGlmICghcmVzdWx0Lkl0ZW0pIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRlc3Q6ICdERUxFVEUnLFxuICAgICAgICBzdGF0dXM6ICdQQVNTJyxcbiAgICAgICAgbWVzc2FnZTogJ1N1Y2Nlc3NmdWxseSBkZWxldGVkIHRlc3Qgc3R1ZGVudCcsXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0ZXN0OiAnREVMRVRFJyxcbiAgICAgICAgc3RhdHVzOiAnRkFJTCcsXG4gICAgICAgIG1lc3NhZ2U6ICdTdHVkZW50IHN0aWxsIGV4aXN0cyBhZnRlciBkZWxldGlvbicsXG4gICAgICB9O1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIHJldHVybiB7XG4gICAgICB0ZXN0OiAnREVMRVRFJyxcbiAgICAgIHN0YXR1czogJ0ZBSUwnLFxuICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogVGVzdDogU2NhbiBPcGVyYXRpb25cbiAqL1xuYXN5bmMgZnVuY3Rpb24gdGVzdFNjYW4oKTogUHJvbWlzZTxUZXN0UmVzdWx0PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY29tbWFuZCA9IG5ldyBTY2FuQ29tbWFuZCh7XG4gICAgICBUYWJsZU5hbWU6IFNUVURFTlRTX1RBQkxFLFxuICAgICAgTGltaXQ6IDUsXG4gICAgfSk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkb2NDbGllbnQuc2VuZChjb21tYW5kKTtcblxuICAgIGlmIChyZXN1bHQuSXRlbXMgJiYgcmVzdWx0Lkl0ZW1zLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRlc3Q6ICdTQ0FOJyxcbiAgICAgICAgc3RhdHVzOiAnUEFTUycsXG4gICAgICAgIG1lc3NhZ2U6IGBTdWNjZXNzZnVsbHkgc2Nhbm5lZCB0YWJsZSAoJHtyZXN1bHQuSXRlbXMubGVuZ3RofSBpdGVtcyBmb3VuZClgLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGVzdDogJ1NDQU4nLFxuICAgICAgICBzdGF0dXM6ICdGQUlMJyxcbiAgICAgICAgbWVzc2FnZTogJ05vIGl0ZW1zIGZvdW5kIGluIHRhYmxlIChtYXkgbmVlZCB0byBzZWVkIGRhdGEpJyxcbiAgICAgIH07XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRlc3Q6ICdTQ0FOJyxcbiAgICAgIHN0YXR1czogJ0ZBSUwnLFxuICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogUnVuIGFsbCB0ZXN0c1xuICovXG5hc3luYyBmdW5jdGlvbiBydW5UZXN0cygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc29sZS5sb2coJ+KVlOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVlycpO1xuICBjb25zb2xlLmxvZygn4pWRICAgICAgIER5bmFtb0RCIExvY2FsIENvbm5lY3Rpb24gVGVzdCBTdWl0ZSAgICAgICAgICAgICAgICDilZEnKTtcbiAgY29uc29sZS5sb2coJ+KVmuKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVnVxcbicpO1xuXG4gIGNvbnNvbGUubG9nKCdDb25maWd1cmF0aW9uOicpO1xuICBjb25zb2xlLmxvZyhgICBFbmRwb2ludDogJHtwcm9jZXNzLmVudi5EWU5BTU9EQl9FTkRQT0lOVCB8fCAnaHR0cDovL2xvY2FsaG9zdDo4MDAyJ31gKTtcbiAgY29uc29sZS5sb2coYCAgUmVnaW9uOiAke3Byb2Nlc3MuZW52LkFXU19SRUdJT04gfHwgJ3VzLWVhc3QtMSd9YCk7XG4gIGNvbnNvbGUubG9nKGAgIE1vZGU6ICR7cHJvY2Vzcy5lbnYuRFlOQU1PREJfTU9ERSB8fCAnYXdzJ31gKTtcbiAgY29uc29sZS5sb2coYCAgVGFibGU6ICR7U1RVREVOVFNfVEFCTEV9XFxuYCk7XG5cbiAgY29uc29sZS5sb2coJ1J1bm5pbmcgdGVzdHMuLi5cXG4nKTtcblxuICAvLyBSdW4gdGVzdHMgc2VxdWVudGlhbGx5XG4gIHJlc3VsdHMucHVzaChhd2FpdCB0ZXN0Q3JlYXRlKCkpO1xuICByZXN1bHRzLnB1c2goYXdhaXQgdGVzdFJlYWQoKSk7XG4gIHJlc3VsdHMucHVzaChhd2FpdCB0ZXN0VXBkYXRlKCkpO1xuICByZXN1bHRzLnB1c2goYXdhaXQgdGVzdERlbGV0ZSgpKTtcbiAgcmVzdWx0cy5wdXNoKGF3YWl0IHRlc3RTY2FuKCkpO1xuXG4gIC8vIFByaW50IHJlc3VsdHNcbiAgY29uc29sZS5sb2coJ1Rlc3QgUmVzdWx0czonKTtcbiAgY29uc29sZS5sb2coJ+KUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgVxcbicpO1xuXG4gIHJlc3VsdHMuZm9yRWFjaCgocmVzdWx0KSA9PiB7XG4gICAgY29uc3Qgc3RhdHVzSWNvbiA9IHJlc3VsdC5zdGF0dXMgPT09ICdQQVNTJyA/ICfinJMnIDogJ+Kclyc7XG4gICAgY29uc3Qgc3RhdHVzQ29sb3IgPSByZXN1bHQuc3RhdHVzID09PSAnUEFTUycgPyAn4pyTJyA6ICfinJcnO1xuICAgIGNvbnNvbGUubG9nKGAgICR7c3RhdHVzQ29sb3J9ICR7cmVzdWx0LnRlc3QucGFkRW5kKDEwKX0gJHtyZXN1bHQuc3RhdHVzfWApO1xuICAgIGlmIChyZXN1bHQubWVzc2FnZSkge1xuICAgICAgY29uc29sZS5sb2coYCAgICDilJTilIAgJHtyZXN1bHQubWVzc2FnZX1gKTtcbiAgICB9XG4gIH0pO1xuXG4gIGNvbnNvbGUubG9nKCdcXG7ilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIEnKTtcblxuICAvLyBTdW1tYXJ5XG4gIGNvbnN0IHBhc3NDb3VudCA9IHJlc3VsdHMuZmlsdGVyKChyKSA9PiByLnN0YXR1cyA9PT0gJ1BBU1MnKS5sZW5ndGg7XG4gIGNvbnN0IGZhaWxDb3VudCA9IHJlc3VsdHMuZmlsdGVyKChyKSA9PiByLnN0YXR1cyA9PT0gJ0ZBSUwnKS5sZW5ndGg7XG5cbiAgY29uc29sZS5sb2coYFxcblN1bW1hcnk6ICR7cGFzc0NvdW50fSBwYXNzZWQsICR7ZmFpbENvdW50fSBmYWlsZWQgb3V0IG9mICR7cmVzdWx0cy5sZW5ndGh9IHRlc3RzXFxuYCk7XG5cbiAgaWYgKGZhaWxDb3VudCA9PT0gMCkge1xuICAgIGNvbnNvbGUubG9nKCfinJMgQWxsIHRlc3RzIHBhc3NlZCEgRHluYW1vREIgTG9jYWwgaXMgd29ya2luZyBjb3JyZWN0bHkuXFxuJyk7XG4gICAgcHJvY2Vzcy5leGl0KDApO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUubG9nKCfinJcgU29tZSB0ZXN0cyBmYWlsZWQuIENoZWNrIGNvbmZpZ3VyYXRpb24gYW5kIER5bmFtb0RCIExvY2FsIHN0YXR1cy5cXG4nKTtcbiAgICBjb25zb2xlLmxvZygnVHJvdWJsZXNob290aW5nOicpO1xuICAgIGNvbnNvbGUubG9nKCcgIDEuIEVuc3VyZSBEeW5hbW9EQiBMb2NhbCBpcyBydW5uaW5nOiBucG0gcnVuIGR5bmFtb2RiOnN0YXJ0Jyk7XG4gICAgY29uc29sZS5sb2coJyAgMi4gVmVyaWZ5IHRhYmxlcyBhcmUgY3JlYXRlZDogbnBtIHJ1biBkeW5hbW9kYjppbml0Jyk7XG4gICAgY29uc29sZS5sb2coJyAgMy4gQ2hlY2sgZW52aXJvbm1lbnQgdmFyaWFibGVzIGluIC5lbnYgZmlsZScpO1xuICAgIGNvbnNvbGUubG9nKCcgIDQuIFZlcmlmeSBEb2NrZXIgY29udGFpbmVyczogZG9ja2VyIHBzJyk7XG4gICAgY29uc29sZS5sb2coJyAgNS4gQ2hlY2sgbG9nczogbnBtIHJ1biBkeW5hbW9kYjpsb2dzXFxuJyk7XG4gICAgcHJvY2Vzcy5leGl0KDEpO1xuICB9XG59XG5cbi8vIFJ1biB0ZXN0c1xucnVuVGVzdHMoKS5jYXRjaCgoZXJyb3IpID0+IHtcbiAgY29uc29sZS5lcnJvcignRmF0YWwgZXJyb3IgcnVubmluZyB0ZXN0czonLCBlcnJvcik7XG4gIHByb2Nlc3MuZXhpdCgxKTtcbn0pO1xuIl19