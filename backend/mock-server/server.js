"use strict";
/**
 * Mock Server for Local Development
 * Simulates backend APIs using mock data
 */
Object.defineProperty(exports, "__esModule", { value: true });
const express = require("express");
const cors = require("cors");
const crypto = require("crypto");
const mocks_1 = require("../test/mocks");
const app = express();
const PORT = process.env.PORT || 3000;
// Middleware
app.use(cors());
app.use(express.json());
// Helper function to hash passwords
function hashPassword(password) {
    return crypto.createHash('sha256').update(password).digest('hex');
}
// In-memory storage for game clicks (simulating database updates)
const gameClicks = new Map();
// Initialize game clicks from mock data
mocks_1.mockGames.forEach(game => {
    gameClicks.set(game.game_id, game.accumulated_click);
});
// ===== Authentication Endpoints =====
/**
 * POST /auth/login
 * Login endpoint for students and teachers
 */
app.post('/auth/login', (req, res) => {
    const { id, password } = req.body;
    if (!id || !password) {
        return res.status(400).json({ message: 'Missing id or password' });
    }
    const hashedPassword = hashPassword(password);
    // Try to find student first
    let user = mocks_1.mockStudents.find(s => s.student_id === id);
    let role = 'student';
    // If not found, try teacher
    if (!user) {
        const teacher = mocks_1.mockTeachers.find(t => t.teacher_id === id);
        if (teacher) {
            user = teacher;
            role = teacher.is_admin ? 'admin' : 'teacher';
        }
    }
    // Verify user exists and password matches
    if (!user || user.password !== hashedPassword) {
        return res.status(401).json({ message: 'Invalid credentials' });
    }
    // Remove password from response
    const { password: _, ...userWithoutPassword } = user;
    return res.json({
        success: true,
        user: userWithoutPassword,
        role,
    });
});
// ===== Games Endpoints =====
/**
 * GET /games
 * Fetch all games
 */
app.get('/games', (req, res) => {
    // Return games with updated click counts
    const gamesWithUpdatedClicks = mocks_1.mockGames.map(game => ({
        ...game,
        accumulated_click: gameClicks.get(game.game_id) || game.accumulated_click,
    }));
    res.json(gamesWithUpdatedClicks);
});
/**
 * GET /games/:gameId
 * Fetch a single game by ID
 */
app.get('/games/:gameId', (req, res) => {
    const { gameId } = req.params;
    const game = mocks_1.mockGames.find(g => g.game_id === gameId);
    if (!game) {
        return res.status(404).json({ message: 'Game not found' });
    }
    // Return game with updated click count
    return res.json({
        ...game,
        accumulated_click: gameClicks.get(game.game_id) || game.accumulated_click,
    });
});
/**
 * POST /games/:gameId/click
 * Increment game click count
 */
app.post('/games/:gameId/click', (req, res) => {
    const { gameId } = req.params;
    const game = mocks_1.mockGames.find(g => g.game_id === gameId);
    if (!game) {
        return res.status(404).json({ message: 'Game not found' });
    }
    // Increment click count
    const currentClicks = gameClicks.get(gameId) || game.accumulated_click;
    gameClicks.set(gameId, currentClicks + 1);
    return res.json({
        success: true,
        accumulated_click: gameClicks.get(gameId),
    });
});
// ===== Server Start =====
app.listen(PORT, () => {
    console.log(`ðŸš€ Mock server running on http://localhost:${PORT}`);
    console.log(`ðŸ“š Serving mock data for local development`);
    console.log(`\nAvailable endpoints:`);
    console.log(`  POST   /auth/login`);
    console.log(`  GET    /games`);
    console.log(`  GET    /games/:gameId`);
    console.log(`  POST   /games/:gameId/click`);
    console.log(`\nMock credentials:`);
    console.log(`  Students: STU001-STU010, password: "123"`);
    console.log(`  Teachers: TCH001-TCH002, password: "teacher123"`);
    console.log(`  Admin:    TCH003, password: "admin123"`);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VydmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic2VydmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7O0FBRUgsbUNBQW9DO0FBQ3BDLDZCQUE4QjtBQUM5QixpQ0FBa0M7QUFDbEMseUNBQXNFO0FBRXRFLE1BQU0sR0FBRyxHQUFHLE9BQU8sRUFBRSxDQUFDO0FBQ3RCLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQztBQUV0QyxhQUFhO0FBQ2IsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0FBQ2hCLEdBQUcsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7QUFFeEIsb0NBQW9DO0FBQ3BDLFNBQVMsWUFBWSxDQUFDLFFBQWdCO0lBQ3BDLE9BQU8sTUFBTSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3BFLENBQUM7QUFFRCxrRUFBa0U7QUFDbEUsTUFBTSxVQUFVLEdBQUcsSUFBSSxHQUFHLEVBQWtCLENBQUM7QUFFN0Msd0NBQXdDO0FBQ3hDLGlCQUFTLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO0lBQ3ZCLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztBQUN2RCxDQUFDLENBQUMsQ0FBQztBQUVILHVDQUF1QztBQUV2Qzs7O0dBR0c7QUFDSCxHQUFHLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDLEdBQW9CLEVBQUUsR0FBcUIsRUFBTyxFQUFFO0lBQzNFLE1BQU0sRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztJQUVsQyxJQUFJLENBQUMsRUFBRSxJQUFJLENB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LENBQUM7SUFDdEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0lBQ3BDLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUMvQixPQUFPLENBQUMsR0FBRyxDQUFDLHlCQUF5QixDQUFDLENBQUM7SUFDdkMsT0FBTyxDQUFDLEdBQUcsQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO0lBQzdDLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUMsQ0FBQztJQUNuQyxPQUFPLENBQUMsR0FBRyxDQUFDLDRDQUE0QyxDQUFDLENBQUM7SUFDMUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtREFBbUQsQ0FBQyxDQUFDO0lBQ2pFLE9BQU8sQ0FBQyxHQUFHLENBQUMsMENBQTBDLENBQUMsQ0FBQztBQUMxRCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTW9jayBTZXJ2ZXIgZm9yIExvY2FsIERldmVsb3BtZW50XG4gKiBTaW11bGF0ZXMgYmFja2VuZCBBUElzIHVzaW5nIG1vY2sgZGF0YVxuICovXG5cbmltcG9ydCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuaW1wb3J0IGNvcnMgPSByZXF1aXJlKCdjb3JzJyk7XG5pbXBvcnQgY3J5cHRvID0gcmVxdWlyZSgnY3J5cHRvJyk7XG5pbXBvcnQgeyBtb2NrU3R1ZGVudHMsIG1vY2tUZWFjaGVycywgbW9ja0dhbWVzIH0gZnJvbSAnLi4vdGVzdC9tb2Nrcyc7XG5cbmNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcbmNvbnN0IFBPUlQgPSBwcm9jZXNzLmVudi5QT1JUIHx8IDMwMDA7XG5cbi8vIE1pZGRsZXdhcmVcbmFwcC51c2UoY29ycygpKTtcbmFwcC51c2UoZXhwcmVzcy5qc29uKCkpO1xuXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gaGFzaCBwYXNzd29yZHNcbmZ1bmN0aW9uIGhhc2hQYXNzd29yZChwYXNzd29yZDogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIGNyeXB0by5jcmVhdGVIYXNoKCdzaGEyNTYnKS51cGRhdGUocGFzc3dvcmQpLmRpZ2VzdCgnaGV4Jyk7XG59XG5cbi8vIEluLW1lbW9yeSBzdG9yYWdlIGZvciBnYW1lIGNsaWNrcyAoc2ltdWxhdGluZyBkYXRhYmFzZSB1cGRhdGVzKVxuY29uc3QgZ2FtZUNsaWNrcyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG5cbi8vIEluaXRpYWxpemUgZ2FtZSBjbGlja3MgZnJvbSBtb2NrIGRhdGFcbm1vY2tHYW1lcy5mb3JFYWNoKGdhbWUgPT4ge1xuICBnYW1lQ2xpY2tzLnNldChnYW1lLmdhbWVfaWQsIGdhbWUuYWNjdW11bGF0ZWRfY2xpY2spO1xufSk7XG5cbi8vID09PT09IEF1dGhlbnRpY2F0aW9uIEVuZHBvaW50cyA9PT09PVxuXG4vKipcbiAqIFBPU1QgL2F1dGgvbG9naW5cbiAqIExvZ2luIGVuZHBvaW50IGZvciBzdHVkZW50cyBhbmQgdGVhY2hlcnNcbiAqL1xuYXBwLnBvc3QoJy9hdXRoL2xvZ2luJywgKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpOiBhbnkgPT4ge1xuICBjb25zdCB7IGlkLCBwYXNzd29yZCB9ID0gcmVxLmJvZHk7XG5cbiAgaWYgKCFpZCB8fCAhcGFzc3dvcmQpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnTWlzc2luZyBpZCBvciBwYXNzd29yZCcgfSk7XG4gIH1cblxuICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGhhc2hQYXNzd29yZChwYXNzd29yZCk7XG5cbiAgLy8gVHJ5IHRvIGZpbmQgc3R1ZGVudCBmaXJzdFxuICBsZXQgdXNlcjogYW55ID0gbW9ja1N0dWRlbnRzLmZpbmQocyA9PiBzLnN0dWRlbnRfaWQgPT09IGlkKTtcbiAgbGV0IHJvbGU6ICdzdHVkZW50JyB8ICd0ZWFjaGVyJyB8ICdhZG1pbicgPSAnc3R1ZGVudCc7XG5cbiAgLy8gSWYgbm90IGZvdW5kLCB0cnkgdGVhY2hlclxuICBpZiAoIXVzZXIpIHtcbiAgICBjb25zdCB0ZWFjaGVyID0gbW9ja1RlYWNoZXJzLmZpbmQodCA9PiB0LnRlYWNoZXJfaWQgPT09IGlkKTtcbiAgICBpZiAodGVhY2hlcikge1xuICAgICAgdXNlciA9IHRlYWNoZXI7XG4gICAgICByb2xlID0gdGVhY2hlci5pc19hZG1pbiA/ICdhZG1pbicgOiAndGVhY2hlcic7XG4gICAgfVxuICB9XG5cbiAgLy8gVmVyaWZ5IHVzZXIgZXhpc3RzIGFuZCBwYXNzd29yZCBtYXRjaGVzXG4gIGlmICghdXNlciB8fCB1c2VyLnBhc3N3b3JkICE9PSBoYXNoZWRQYXNzd29yZCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6ICdJbnZhbGlkIGNyZWRlbnRpYWxzJyB9KTtcbiAgfVxuXG4gIC8vIFJlbW92ZSBwYXNzd29yZCBmcm9tIHJlc3BvbnNlXG4gIGNvbnN0IHsgcGFzc3dvcmQ6IF8sIC4uLnVzZXJXaXRob3V0UGFzc3dvcmQgfSA9IHVzZXI7XG5cbiAgcmV0dXJuIHJlcy5qc29uKHtcbiAgICBzdWNjZXNzOiB0cnVlLFxuICAgIHVzZXI6IHVzZXJXaXRob3V0UGFzc3dvcmQsXG4gICAgcm9sZSxcbiAgfSk7XG59KTtcblxuLy8gPT09PT0gR2FtZXMgRW5kcG9pbnRzID09PT09XG5cbi8qKlxuICogR0VUIC9nYW1lc1xuICogRmV0Y2ggYWxsIGdhbWVzXG4gKi9cbmFwcC5nZXQoJy9nYW1lcycsIChyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlKSA9PiB7XG4gIC8vIFJldHVybiBnYW1lcyB3aXRoIHVwZGF0ZWQgY2xpY2sgY291bnRzXG4gIGNvbnN0IGdhbWVzV2l0aFVwZGF0ZWRDbGlja3MgPSBtb2NrR2FtZXMubWFwKGdhbWUgPT4gKHtcbiAgICAuLi5nYW1lLFxuICAgIGFjY3VtdWxhdGVkX2NsaWNrOiBnYW1lQ2xpY2tzLmdldChnYW1lLmdhbWVfaWQpIHx8IGdhbWUuYWNjdW11bGF0ZWRfY2xpY2ssXG4gIH0pKTtcblxuICByZXMuanNvbihnYW1lc1dpdGhVcGRhdGVkQ2xpY2tzKTtcbn0pO1xuXG4vKipcbiAqIEdFVCAvZ2FtZXMvOmdhbWVJZFxuICogRmV0Y2ggYSBzaW5nbGUgZ2FtZSBieSBJRFxuICovXG5hcHAuZ2V0KCcvZ2FtZXMvOmdhbWVJZCcsIChyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlKTogYW55ID0+IHtcbiAgY29uc3QgeyBnYW1lSWQgfSA9IHJlcS5wYXJhbXM7XG4gIGNvbnN0IGdhbWUgPSBtb2NrR2FtZXMuZmluZChnID0+IGcuZ2FtZV9pZCA9PT0gZ2FtZUlkKTtcblxuICBpZiAoIWdhbWUpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnR2FtZSBub3QgZm91bmQnIH0pO1xuICB9XG5cbiAgLy8gUmV0dXJuIGdhbWUgd2l0aCB1cGRhdGVkIGNsaWNrIGNvdW50XG4gIHJldHVybiByZXMuanNvbih7XG4gICAgLi4uZ2FtZSxcbiAgICBhY2N1bXVsYXRlZF9jbGljazogZ2FtZUNsaWNrcy5nZXQoZ2FtZS5nYW1lX2lkKSB8fCBnYW1lLmFjY3VtdWxhdGVkX2NsaWNrLFxuICB9KTtcbn0pO1xuXG4vKipcbiAqIFBPU1QgL2dhbWVzLzpnYW1lSWQvY2xpY2tcbiAqIEluY3JlbWVudCBnYW1lIGNsaWNrIGNvdW50XG4gKi9cbmFwcC5wb3N0KCcvZ2FtZXMvOmdhbWVJZC9jbGljaycsIChyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlKTogYW55ID0+IHtcbiAgY29uc3QgeyBnYW1lSWQgfSA9IHJlcS5wYXJhbXM7XG4gIGNvbnN0IGdhbWUgPSBtb2NrR2FtZXMuZmluZChnID0+IGcuZ2FtZV9pZCA9PT0gZ2FtZUlkKTtcblxuICBpZiAoIWdhbWUpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnR2FtZSBub3QgZm91bmQnIH0pO1xuICB9XG5cbiAgLy8gSW5jcmVtZW50IGNsaWNrIGNvdW50XG4gIGNvbnN0IGN1cnJlbnRDbGlja3MgPSBnYW1lQ2xpY2tzLmdldChnYW1lSWQpIHx8IGdhbWUuYWNjdW11bGF0ZWRfY2xpY2s7XG4gIGdhbWVDbGlja3Muc2V0KGdhbWVJZCwgY3VycmVudENsaWNrcyArIDEpO1xuXG4gIHJldHVybiByZXMuanNvbih7XG4gICAgc3VjY2VzczogdHJ1ZSxcbiAgICBhY2N1bXVsYXRlZF9jbGljazogZ2FtZUNsaWNrcy5nZXQoZ2FtZUlkKSxcbiAgfSk7XG59KTtcblxuLy8gPT09PT0gU2VydmVyIFN0YXJ0ID09PT09XG5cbmFwcC5saXN0ZW4oUE9SVCwgKCkgPT4ge1xuICBjb25zb2xlLmxvZyhg8J+agCBNb2NrIHNlcnZlciBydW5uaW5nIG9uIGh0dHA6Ly9sb2NhbGhvc3Q6JHtQT1JUfWApO1xuICBjb25zb2xlLmxvZyhg8J+TmiBTZXJ2aW5nIG1vY2sgZGF0YSBmb3IgbG9jYWwgZGV2ZWxvcG1lbnRgKTtcbiAgY29uc29sZS5sb2coYFxcbkF2YWlsYWJsZSBlbmRwb2ludHM6YCk7XG4gIGNvbnNvbGUubG9nKGAgIFBPU1QgICAvYXV0aC9sb2dpbmApO1xuICBjb25zb2xlLmxvZyhgICBHRVQgICAgL2dhbWVzYCk7XG4gIGNvbnNvbGUubG9nKGAgIEdFVCAgICAvZ2FtZXMvOmdhbWVJZGApO1xuICBjb25zb2xlLmxvZyhgICBQT1NUICAgL2dhbWVzLzpnYW1lSWQvY2xpY2tgKTtcbiAgY29uc29sZS5sb2coYFxcbk1vY2sgY3JlZGVudGlhbHM6YCk7XG4gIGNvbnNvbGUubG9nKGAgIFN0dWRlbnRzOiBTVFUwMDEtU1RVMDEwLCBwYXNzd29yZDogXCIxMjNcImApO1xuICBjb25zb2xlLmxvZyhgICBUZWFjaGVyczogVENIMDAxLVRDSDAwMiwgcGFzc3dvcmQ6IFwidGVhY2hlcjEyM1wiYCk7XG4gIGNvbnNvbGUubG9nKGAgIEFkbWluOiAgICBUQ0gwMDMsIHBhc3N3b3JkOiBcImFkbWluMTIzXCJgKTtcbn0pO1xuIl19