"use strict";
/**
 * Mock Server for Local Development
 * Simulates backend APIs using mock data
 */
Object.defineProperty(exports, "__esModule", { value: true });
const express = require("express");
const cors = require("cors");
const crypto = require("crypto");
const mocks_1 = require("../test/mocks");
const app = express();
const PORT = process.env.PORT || 3000;
// Middleware
app.use(cors());
app.use(express.json());
// Helper function to hash passwords
function hashPassword(password) {
    return crypto.createHash('sha256').update(password).digest('hex');
}
// In-memory storage for game clicks (simulating database updates)
const gameClicks = new Map();
// Initialize game clicks from mock data
mocks_1.mockGames.forEach(game => {
    gameClicks.set(game.game_id, game.accumulated_click);
});
// ===== Authentication Endpoints =====
/**
 * POST /auth/login
 * Login endpoint for students and teachers
 */
app.post('/auth/login', (req, res) => {
    const { id, password } = req.body;
    if (!id || !password) {
        return res.status(400).json({ message: 'Missing id or password' });
    }
    const hashedPassword = hashPassword(password);
    // Try to find student first
    let user = mocks_1.mockStudents.find(s => s.student_id === id);
    let role = 'student';
    // If not found, try teacher
    if (!user) {
        const teacher = mocks_1.mockTeachers.find(t => t.teacher_id === id);
        if (teacher) {
            user = teacher;
            role = teacher.is_admin ? 'admin' : 'teacher';
        }
    }
    // Verify user exists and password matches
    if (!user || user.password !== hashedPassword) {
        return res.status(401).json({ message: 'Invalid credentials' });
    }
    // Remove password from response
    const { password: _, ...userWithoutPassword } = user;
    res.json({
        success: true,
        user: userWithoutPassword,
        role,
    });
});
// ===== Games Endpoints =====
/**
 * GET /games
 * Fetch all games
 */
app.get('/games', (req, res) => {
    // Return games with updated click counts
    const gamesWithUpdatedClicks = mocks_1.mockGames.map(game => ({
        ...game,
        accumulated_click: gameClicks.get(game.game_id) || game.accumulated_click,
    }));
    res.json(gamesWithUpdatedClicks);
});
/**
 * GET /games/:gameId
 * Fetch a single game by ID
 */
app.get('/games/:gameId', (req, res) => {
    const { gameId } = req.params;
    const game = mocks_1.mockGames.find(g => g.game_id === gameId);
    if (!game) {
        return res.status(404).json({ message: 'Game not found' });
    }
    // Return game with updated click count
    res.json({
        ...game,
        accumulated_click: gameClicks.get(game.game_id) || game.accumulated_click,
    });
});
/**
 * POST /games/:gameId/click
 * Increment game click count
 */
app.post('/games/:gameId/click', (req, res) => {
    const { gameId } = req.params;
    const game = mocks_1.mockGames.find(g => g.game_id === gameId);
    if (!game) {
        return res.status(404).json({ message: 'Game not found' });
    }
    // Increment click count
    const currentClicks = gameClicks.get(gameId) || game.accumulated_click;
    gameClicks.set(gameId, currentClicks + 1);
    res.json({
        success: true,
        accumulated_click: gameClicks.get(gameId),
    });
});
// ===== Server Start =====
app.listen(PORT, () => {
    console.log(`ðŸš€ Mock server running on http://localhost:${PORT}`);
    console.log(`ðŸ“š Serving mock data for local development`);
    console.log(`\nAvailable endpoints:`);
    console.log(`  POST   /auth/login`);
    console.log(`  GET    /games`);
    console.log(`  GET    /games/:gameId`);
    console.log(`  POST   /games/:gameId/click`);
    console.log(`\nMock credentials:`);
    console.log(`  Students: STU001-STU010, password: "123"`);
    console.log(`  Teachers: TCH001-TCH002, password: "teacher123"`);
    console.log(`  Admin:    TCH003, password: "admin123"`);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VydmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic2VydmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7O0FBRUgsbUNBQW9DO0FBQ3BDLDZCQUE4QjtBQUM5QixpQ0FBa0M7QUFDbEMseUNBQXNFO0FBRXRFLE1BQU0sR0FBRyxHQUFHLE9BQU8sRUFBRSxDQUFDO0FBQ3RCLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQztBQUV0QyxhQUFhO0FBQ2IsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0FBQ2hCLEdBQUcsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7QUFFeEIsb0NBQW9DO0FBQ3BDLFNBQVMsWUFBWSxDQUFDLFFBQWdCO0lBQ3BDLE9BQU8sTUFBTSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3BFLENBQUM7QUFFRCxrRUFBa0U7QUFDbEUsTUFBTSxVQUFVLEdBQUcsSUFBSSxHQUFHLEVBQWtCLENBQUM7QUFFN0Msd0NBQXdDO0FBQ3hDLGlCQUFTLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO0lBQ3ZCLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztBQUN2RCxDQUFDLENBQUMsQ0FBQztBQUVILHVDQUF1QztBQUV2Qzs7O0dBR0c7QUFDSCxHQUFHLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDLEdBQW9CLEVBQUUsR0FBcUIsRUFBRSxFQUFFO0lBQ3RFLE1BQU0sRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztJQUVsQyxJQUFJLENBQUMsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDckIsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxDQUFDLENBQUM7SUFDckUsQ0FBQztJQUVELE1BQU0sY0FBYyxHQUFHLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUU5Qyw0QkFBNEI7SUFDNUIsSUFBSSxJQUFJLEdBQUcsb0JBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsVUFBVSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZELElBQUksSUFBSSxHQUFvQyxTQUFTLENBQUM7SUFFdEQsNEJBQTRCO0lBQzVCLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNWLE1BQU0sT0FBTyxHQUFHLG9CQUFZLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFVBQVUsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUM1RCxJQUFJLE9BQU8sRUFBRSxDQUFDO1lBQ1osSUFBSSxHQUFHLE9BQU8sQ0FBQztZQUNmLElBQUksR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztRQUNoRCxDQUFDO0lBQ0gsQ0FBQztJQUVELDBDQUEwQztJQUMxQyxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxRQUFRLEtBQUssY0FBYyxFQUFFLENBQUM7UUFDOUMsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxDQUFDLENBQUM7SUFDbEUsQ0FBQztJQUVELGdDQUFnQztJQUNoQyxNQUFNLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxHQUFHLG1CQUFtQixFQUFFLEdBQUcsSUFBSSxDQUFDO0lBRXJELEdBQUcsQ0FBQyxJQUFJLENBQUM7UUFDUCxPQUFPLEVBQUUsSUFBSTtRQUNiLElBQUksRUFBRSxtQkFBbUI7UUFDekIsSUFBSTtLQUNMLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsOEJBQThCO0FBRTlCOzs7R0FHRztBQUNILEdBQUcsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLENBQUMsR0FBb0IsRUFBRSxHQUFxQixFQUFFLEVBQUU7SUFDaEUseUNBQXlDO0lBQ3pDLE1BQU0sc0JBQXNCLEdBQUcsaUJBQVMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3BELEdBQUcsSUFBSTtRQUNQLGlCQUFpQixFQUFFLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLElBQUksQ0FBQyxpQkFBaUI7S0FDMUUsQ0FBQyxDQUFDLENBQUM7SUFFSixHQUFHLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUM7QUFDbkMsQ0FBQyxDQUFDLENBQUM7QUFFSDs7O0dBR0c7QUFDSCxHQUFHLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLENBQUMsR0FBb0IsRUFBRSxHQUFxQixFQUFFLEVBQUU7SUFDeEUsTUFBTSxFQUFFLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUM7SUFDOUIsTUFBTSxJQUFJLEdBQUcsaUJBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxLQUFLLE1BQU0sQ0FBQyxDQUFDO0lBRXZELElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNWLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDO0lBQzdELENBQUM7SUFFRCx1Q0FBdUM7SUFDdkMsR0FBRyxDQUFDLElBQUksQ0FBQztRQUNQLEdBQUcsSUFBSTtRQUNQLGlCQUFpQixFQUFFLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLElBQUksQ0FBQyxpQkFBaUI7S0FDMUUsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSDs7O0dBR0c7QUFDSCxHQUFHLENBQUMsSUFBSSxDQUFDLHNCQUFzQixFQUFFLENBQUMsR0FBb0IsRUFBRSxHQUFxQixFQUFFLEVBQUU7SUFDL0UsTUFBTSxFQUFFLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUM7SUFDOUIsTUFBTSxJQUFJLEdBQUcsaUJBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxLQUFLLE1BQU0sQ0FBQyxDQUFDO0lBRXZELElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNWLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDO0lBQzdELENBQUM7SUFFRCx3QkFBd0I7SUFDeEIsTUFBTSxhQUFhLEdBQUcsVUFBVSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxJQUFJLENBQUMsaUJBQWlCLENBQUM7SUFDdkUsVUFBVSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsYUFBYSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBRTFDLEdBQUcsQ0FBQyxJQUFJLENBQUM7UUFDUCxPQUFPLEVBQUUsSUFBSTtRQUNiLGlCQUFpQixFQUFFLFVBQVUsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDO0tBQzFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsMkJBQTJCO0FBRTNCLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRTtJQUNwQixPQUFPLENBQUMsR0FBRyxDQUFDLDhDQUE4QyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBQ2xFLE9BQU8sQ0FBQyxHQUFHLENBQUMsNENBQTRDLENBQUMsQ0FBQztJQUMxRCxPQUFPLENBQUMsR0FBRyxDQUFDLHdCQUF3QixDQUFDLENBQUM7SUFDdEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0lBQ3BDLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUMvQixPQUFPLENBQUMsR0FBRyxDQUFDLHlCQUF5QixDQUFDLENBQUM7SUFDdkMsT0FBTyxDQUFDLEdBQUcsQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO0lBQzdDLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUMsQ0FBQztJQUNuQyxPQUFPLENBQUMsR0FBRyxDQUFDLDRDQUE0QyxDQUFDLENBQUM7SUFDMUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtREFBbUQsQ0FBQyxDQUFDO0lBQ2pFLE9BQU8sQ0FBQyxHQUFHLENBQUMsMENBQTBDLENBQUMsQ0FBQztBQUMxRCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTW9jayBTZXJ2ZXIgZm9yIExvY2FsIERldmVsb3BtZW50XG4gKiBTaW11bGF0ZXMgYmFja2VuZCBBUElzIHVzaW5nIG1vY2sgZGF0YVxuICovXG5cbmltcG9ydCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuaW1wb3J0IGNvcnMgPSByZXF1aXJlKCdjb3JzJyk7XG5pbXBvcnQgY3J5cHRvID0gcmVxdWlyZSgnY3J5cHRvJyk7XG5pbXBvcnQgeyBtb2NrU3R1ZGVudHMsIG1vY2tUZWFjaGVycywgbW9ja0dhbWVzIH0gZnJvbSAnLi4vdGVzdC9tb2Nrcyc7XG5cbmNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcbmNvbnN0IFBPUlQgPSBwcm9jZXNzLmVudi5QT1JUIHx8IDMwMDA7XG5cbi8vIE1pZGRsZXdhcmVcbmFwcC51c2UoY29ycygpKTtcbmFwcC51c2UoZXhwcmVzcy5qc29uKCkpO1xuXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gaGFzaCBwYXNzd29yZHNcbmZ1bmN0aW9uIGhhc2hQYXNzd29yZChwYXNzd29yZDogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIGNyeXB0by5jcmVhdGVIYXNoKCdzaGEyNTYnKS51cGRhdGUocGFzc3dvcmQpLmRpZ2VzdCgnaGV4Jyk7XG59XG5cbi8vIEluLW1lbW9yeSBzdG9yYWdlIGZvciBnYW1lIGNsaWNrcyAoc2ltdWxhdGluZyBkYXRhYmFzZSB1cGRhdGVzKVxuY29uc3QgZ2FtZUNsaWNrcyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG5cbi8vIEluaXRpYWxpemUgZ2FtZSBjbGlja3MgZnJvbSBtb2NrIGRhdGFcbm1vY2tHYW1lcy5mb3JFYWNoKGdhbWUgPT4ge1xuICBnYW1lQ2xpY2tzLnNldChnYW1lLmdhbWVfaWQsIGdhbWUuYWNjdW11bGF0ZWRfY2xpY2spO1xufSk7XG5cbi8vID09PT09IEF1dGhlbnRpY2F0aW9uIEVuZHBvaW50cyA9PT09PVxuXG4vKipcbiAqIFBPU1QgL2F1dGgvbG9naW5cbiAqIExvZ2luIGVuZHBvaW50IGZvciBzdHVkZW50cyBhbmQgdGVhY2hlcnNcbiAqL1xuYXBwLnBvc3QoJy9hdXRoL2xvZ2luJywgKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpID0+IHtcbiAgY29uc3QgeyBpZCwgcGFzc3dvcmQgfSA9IHJlcS5ib2R5O1xuXG4gIGlmICghaWQgfHwgIXBhc3N3b3JkKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ01pc3NpbmcgaWQgb3IgcGFzc3dvcmQnIH0pO1xuICB9XG5cbiAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBoYXNoUGFzc3dvcmQocGFzc3dvcmQpO1xuXG4gIC8vIFRyeSB0byBmaW5kIHN0dWRlbnQgZmlyc3RcbiAgbGV0IHVzZXIgPSBtb2NrU3R1ZGVudHMuZmluZChzID0+IHMuc3R1ZGVudF9pZCA9PT0gaWQpO1xuICBsZXQgcm9sZTogJ3N0dWRlbnQnIHwgJ3RlYWNoZXInIHwgJ2FkbWluJyA9ICdzdHVkZW50JztcblxuICAvLyBJZiBub3QgZm91bmQsIHRyeSB0ZWFjaGVyXG4gIGlmICghdXNlcikge1xuICAgIGNvbnN0IHRlYWNoZXIgPSBtb2NrVGVhY2hlcnMuZmluZCh0ID0+IHQudGVhY2hlcl9pZCA9PT0gaWQpO1xuICAgIGlmICh0ZWFjaGVyKSB7XG4gICAgICB1c2VyID0gdGVhY2hlcjtcbiAgICAgIHJvbGUgPSB0ZWFjaGVyLmlzX2FkbWluID8gJ2FkbWluJyA6ICd0ZWFjaGVyJztcbiAgICB9XG4gIH1cblxuICAvLyBWZXJpZnkgdXNlciBleGlzdHMgYW5kIHBhc3N3b3JkIG1hdGNoZXNcbiAgaWYgKCF1c2VyIHx8IHVzZXIucGFzc3dvcmQgIT09IGhhc2hlZFBhc3N3b3JkKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgbWVzc2FnZTogJ0ludmFsaWQgY3JlZGVudGlhbHMnIH0pO1xuICB9XG5cbiAgLy8gUmVtb3ZlIHBhc3N3b3JkIGZyb20gcmVzcG9uc2VcbiAgY29uc3QgeyBwYXNzd29yZDogXywgLi4udXNlcldpdGhvdXRQYXNzd29yZCB9ID0gdXNlcjtcblxuICByZXMuanNvbih7XG4gICAgc3VjY2VzczogdHJ1ZSxcbiAgICB1c2VyOiB1c2VyV2l0aG91dFBhc3N3b3JkLFxuICAgIHJvbGUsXG4gIH0pO1xufSk7XG5cbi8vID09PT09IEdhbWVzIEVuZHBvaW50cyA9PT09PVxuXG4vKipcbiAqIEdFVCAvZ2FtZXNcbiAqIEZldGNoIGFsbCBnYW1lc1xuICovXG5hcHAuZ2V0KCcvZ2FtZXMnLCAocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSkgPT4ge1xuICAvLyBSZXR1cm4gZ2FtZXMgd2l0aCB1cGRhdGVkIGNsaWNrIGNvdW50c1xuICBjb25zdCBnYW1lc1dpdGhVcGRhdGVkQ2xpY2tzID0gbW9ja0dhbWVzLm1hcChnYW1lID0+ICh7XG4gICAgLi4uZ2FtZSxcbiAgICBhY2N1bXVsYXRlZF9jbGljazogZ2FtZUNsaWNrcy5nZXQoZ2FtZS5nYW1lX2lkKSB8fCBnYW1lLmFjY3VtdWxhdGVkX2NsaWNrLFxuICB9KSk7XG5cbiAgcmVzLmpzb24oZ2FtZXNXaXRoVXBkYXRlZENsaWNrcyk7XG59KTtcblxuLyoqXG4gKiBHRVQgL2dhbWVzLzpnYW1lSWRcbiAqIEZldGNoIGEgc2luZ2xlIGdhbWUgYnkgSURcbiAqL1xuYXBwLmdldCgnL2dhbWVzLzpnYW1lSWQnLCAocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSkgPT4ge1xuICBjb25zdCB7IGdhbWVJZCB9ID0gcmVxLnBhcmFtcztcbiAgY29uc3QgZ2FtZSA9IG1vY2tHYW1lcy5maW5kKGcgPT4gZy5nYW1lX2lkID09PSBnYW1lSWQpO1xuXG4gIGlmICghZ2FtZSkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdHYW1lIG5vdCBmb3VuZCcgfSk7XG4gIH1cblxuICAvLyBSZXR1cm4gZ2FtZSB3aXRoIHVwZGF0ZWQgY2xpY2sgY291bnRcbiAgcmVzLmpzb24oe1xuICAgIC4uLmdhbWUsXG4gICAgYWNjdW11bGF0ZWRfY2xpY2s6IGdhbWVDbGlja3MuZ2V0KGdhbWUuZ2FtZV9pZCkgfHwgZ2FtZS5hY2N1bXVsYXRlZF9jbGljayxcbiAgfSk7XG59KTtcblxuLyoqXG4gKiBQT1NUIC9nYW1lcy86Z2FtZUlkL2NsaWNrXG4gKiBJbmNyZW1lbnQgZ2FtZSBjbGljayBjb3VudFxuICovXG5hcHAucG9zdCgnL2dhbWVzLzpnYW1lSWQvY2xpY2snLCAocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSkgPT4ge1xuICBjb25zdCB7IGdhbWVJZCB9ID0gcmVxLnBhcmFtcztcbiAgY29uc3QgZ2FtZSA9IG1vY2tHYW1lcy5maW5kKGcgPT4gZy5nYW1lX2lkID09PSBnYW1lSWQpO1xuXG4gIGlmICghZ2FtZSkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdHYW1lIG5vdCBmb3VuZCcgfSk7XG4gIH1cblxuICAvLyBJbmNyZW1lbnQgY2xpY2sgY291bnRcbiAgY29uc3QgY3VycmVudENsaWNrcyA9IGdhbWVDbGlja3MuZ2V0KGdhbWVJZCkgfHwgZ2FtZS5hY2N1bXVsYXRlZF9jbGljaztcbiAgZ2FtZUNsaWNrcy5zZXQoZ2FtZUlkLCBjdXJyZW50Q2xpY2tzICsgMSk7XG5cbiAgcmVzLmpzb24oe1xuICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgYWNjdW11bGF0ZWRfY2xpY2s6IGdhbWVDbGlja3MuZ2V0KGdhbWVJZCksXG4gIH0pO1xufSk7XG5cbi8vID09PT09IFNlcnZlciBTdGFydCA9PT09PVxuXG5hcHAubGlzdGVuKFBPUlQsICgpID0+IHtcbiAgY29uc29sZS5sb2coYPCfmoAgTW9jayBzZXJ2ZXIgcnVubmluZyBvbiBodHRwOi8vbG9jYWxob3N0OiR7UE9SVH1gKTtcbiAgY29uc29sZS5sb2coYPCfk5ogU2VydmluZyBtb2NrIGRhdGEgZm9yIGxvY2FsIGRldmVsb3BtZW50YCk7XG4gIGNvbnNvbGUubG9nKGBcXG5BdmFpbGFibGUgZW5kcG9pbnRzOmApO1xuICBjb25zb2xlLmxvZyhgICBQT1NUICAgL2F1dGgvbG9naW5gKTtcbiAgY29uc29sZS5sb2coYCAgR0VUICAgIC9nYW1lc2ApO1xuICBjb25zb2xlLmxvZyhgICBHRVQgICAgL2dhbWVzLzpnYW1lSWRgKTtcbiAgY29uc29sZS5sb2coYCAgUE9TVCAgIC9nYW1lcy86Z2FtZUlkL2NsaWNrYCk7XG4gIGNvbnNvbGUubG9nKGBcXG5Nb2NrIGNyZWRlbnRpYWxzOmApO1xuICBjb25zb2xlLmxvZyhgICBTdHVkZW50czogU1RVMDAxLVNUVTAxMCwgcGFzc3dvcmQ6IFwiMTIzXCJgKTtcbiAgY29uc29sZS5sb2coYCAgVGVhY2hlcnM6IFRDSDAwMS1UQ0gwMDIsIHBhc3N3b3JkOiBcInRlYWNoZXIxMjNcImApO1xuICBjb25zb2xlLmxvZyhgICBBZG1pbjogICAgVENIMDAzLCBwYXNzd29yZDogXCJhZG1pbjEyM1wiYCk7XG59KTtcbiJdfQ==